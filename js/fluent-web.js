/* @fluent/web@0.2.0 */const likelySubtagsMin={ar:"ar-arab-eg","az-arab":"az-arab-ir","az-ir":"az-arab-ir",be:"be-cyrl-by",da:"da-latn-dk",el:"el-grek-gr",en:"en-latn-us",fa:"fa-arab-ir",ja:"ja-jpan-jp",ko:"ko-kore-kr",pt:"pt-latn-br",sr:"sr-cyrl-rs","sr-ru":"sr-latn-ru",sv:"sv-latn-se",ta:"ta-taml-in",uk:"uk-cyrl-ua",zh:"zh-hans-cn","zh-hant":"zh-hant-tw","zh-hk":"zh-hant-hk","zh-gb":"zh-hant-gb","zh-us":"zh-hant-us"},regionMatchingLangs=["az","bg","cs","de","es","fi","fr","hu","it","lt","lv","nl","pl","ro","ru"];function getLikelySubtagsMin(e){if(likelySubtagsMin.hasOwnProperty(e))return new Locale(likelySubtagsMin[e]);const t=new Locale(e);return regionMatchingLangs.includes(t.language)?(t.region=t.language.toUpperCase(),t):null}const languageCodeRe="([a-z]{2,3}|\\*)",scriptCodeRe="(?:-([a-z]{4}|\\*))",regionCodeRe="(?:-([a-z]{2}|\\*))",variantCodeRe="(?:-(([0-9][a-z0-9]{3}|[a-z0-9]{5,8})|\\*))",localeRe=new RegExp(`^${"([a-z]{2,3}|\\*)"}${scriptCodeRe}?${regionCodeRe}?${variantCodeRe}?$`,"i"),localeParts=["language","script","region","variant"];class Locale{constructor(e){const t=localeRe.exec(e.replace(/_/g,"-"));if(!t)return void(this.isWellFormed=!1);let[,n,a,r,i]=t;n&&(this.language=n.toLowerCase()),a&&(this.script=a[0].toUpperCase()+a.slice(1)),r&&(this.region=r.toUpperCase()),this.variant=i,this.isWellFormed=!0}isEqual(e){return localeParts.every(t=>this[t]===e[t])}matches(e,t=!1,n=!1){return localeParts.every(a=>t&&void 0===this[a]||n&&void 0===e[a]||this[a]===e[a])}toString(){return localeParts.map(e=>this[e]).filter(e=>e!==void 0).join("-")}clearVariants(){this.variant=void 0}clearRegion(){this.region=void 0}addLikelySubtags(){const e=getLikelySubtagsMin(this.toString().toLowerCase());return!!e&&(localeParts.forEach(t=>this[t]=e[t]),!0)}}function filterMatches(e,t,n){const a=new Set,r=new Map;for(let a of t){let e=new Locale(a);e.isWellFormed&&r.set(a,new Locale(a))}outer:for(const t of e){const e=t.toLowerCase(),i=new Locale(e);if(void 0!==i.language){for(const t of r.keys())if(e===t.toLowerCase()){if(a.add(t),r.delete(t),"lookup"===n)return Array.from(a);if("filtering"===n)continue;else continue outer}for(const[e,t]of r.entries())if(t.matches(i,!0,!1)){if(a.add(e),r.delete(e),"lookup"===n)return Array.from(a);if("filtering"===n)continue;else continue outer}if(i.addLikelySubtags())for(const[e,t]of r.entries())if(t.matches(i,!0,!1)){if(a.add(e),r.delete(e),"lookup"===n)return Array.from(a);if("filtering"===n)continue;else continue outer}i.clearVariants();for(const[e,t]of r.entries())if(t.matches(i,!0,!0)){if(a.add(e),r.delete(e),"lookup"===n)return Array.from(a);if("filtering"===n)continue;else continue outer}if(i.clearRegion(),i.addLikelySubtags())for(const[e,t]of r.entries())if(t.matches(i,!0,!1)){if(a.add(e),r.delete(e),"lookup"===n)return Array.from(a);if("filtering"===n)continue;else continue outer}i.clearRegion();for(const[e,t]of r.entries())if(t.matches(i,!0,!0)){if(a.add(e),r.delete(e),"lookup"===n)return Array.from(a);if("filtering"===n)continue;else continue outer}}}return Array.from(a)}function GetOption(e,t,n,a,r){let i=e[t];if(void 0!==i){if("boolean"===n?i=new Boolean(i):"string"==n&&(i+=""),void 0!==a&&-1===a.indexOf(i))throw new Error("Invalid option value");return i}return r}function negotiateLanguages(e,t,n={}){const a=GetOption(n,"defaultLocale","string"),r=GetOption(n,"strategy","string",["filtering","matching","lookup"],"filtering");if("lookup"===r&&!a)throw new Error("defaultLocale cannot be undefined for strategy `lookup`");const i=Array.from(Object(e)).map(e=>e+""),l=Array.from(Object(t)).map(e=>e+""),s=filterMatches(i,l,r);return"lookup"===r?0===s.length&&s.push(a):a&&!s.includes(a)&&s.push(a),s}class FluentType{constructor(e){this.value=e}valueOf(){return this.value}toString(e){throw new Error("Subclasses of FluentType must implement toString.")}}class FluentNone extends FluentType{constructor(e="???"){super(e)}toString(){return`{${this.value}}`}}class FluentNumber extends FluentType{constructor(e,t){super(e),this.opts=t}toString(e){try{const t=e.memoizeIntlObject(Intl.NumberFormat,this.opts);return t.format(this.value)}catch(t){return e.reportError(t),this.value.toString(10)}}}class FluentDateTime extends FluentType{constructor(e,t){super(e),this.opts=t}toString(e){try{const t=e.memoizeIntlObject(Intl.DateTimeFormat,this.opts);return t.format(this.value)}catch(t){return e.reportError(t),new Date(this.value).toISOString()}}}function merge(e,t){return Object.assign({},e,values(t))}function values(e){const t={};for(const[n,a]of Object.entries(e))t[n]=a.valueOf();return t}function NUMBER([e],t){if(e instanceof FluentNone)return new FluentNone(`NUMBER(${e.valueOf()})`);let n=+e.valueOf();if(Number.isNaN(n))throw new TypeError("Invalid argument to NUMBER");return new FluentNumber(n,merge(e.opts,t))}function DATETIME([e],t){if(e instanceof FluentNone)return new FluentNone(`DATETIME(${e.valueOf()})`);let n=+e.valueOf();if(Number.isNaN(n))throw new TypeError("Invalid argument to DATETIME");return new FluentDateTime(n,merge(e.opts,t))}var builtins=Object.freeze({NUMBER:NUMBER,DATETIME:DATETIME});const MAX_PLACEABLE_LENGTH=2500,FSI="\u2068",PDI="\u2069";function match(e,t,n){if(n===t)return!0;if(n instanceof FluentNumber&&t instanceof FluentNumber&&n.value===t.value)return!0;if(t instanceof FluentNumber&&"string"==typeof n){let a=e.memoizeIntlObject(Intl.PluralRules,t.opts).select(t.value);if(n===a)return!0}return!1}function getDefault(e,t,n){return t[n]?resolvePattern(e,t[n].value):(e.reportError(new RangeError("No default")),new FluentNone)}function getArguments(e,t){const n=[],a={};for(const r of t)"narg"===r.type?a[r.name]=resolveExpression(e,r.value):n.push(resolveExpression(e,r));return[n,a]}function resolveExpression(e,t){switch(t.type){case"str":return t.value;case"num":return new FluentNumber(t.value,{minimumFractionDigits:t.precision});case"var":return VariableReference(e,t);case"mesg":return MessageReference(e,t);case"term":return TermReference(e,t);case"func":return FunctionReference(e,t);case"select":return SelectExpression(e,t);default:return new FluentNone;}}function VariableReference(e,{name:t}){if(!e.args||!e.args.hasOwnProperty(t))return!1===e.insideTermReference&&e.reportError(new ReferenceError(`Unknown variable: $${t}`)),new FluentNone(`$${t}`);const n=e.args[t];if(n instanceof FluentType)return n;switch(typeof n){case"string":return n;case"number":return new FluentNumber(n);case"object":if(n instanceof Date)return new FluentDateTime(n.getTime());default:return e.reportError(new TypeError(`Variable type not supported: $${t}, ${typeof n}`)),new FluentNone(`$${t}`);}}function MessageReference(e,{name:t,attr:n}){const a=e.bundle._messages.get(t);if(!a)return e.reportError(new ReferenceError(`Unknown message: ${t}`)),new FluentNone(t);if(n){const r=a.attributes[n];return r?resolvePattern(e,r):(e.reportError(new ReferenceError(`Unknown attribute: ${n}`)),new FluentNone(`${t}.${n}`))}return a.value?resolvePattern(e,a.value):(e.reportError(new ReferenceError(`No value: ${t}`)),new FluentNone(t))}function TermReference(e,{name:t,attr:n,args:a}){const r=`-${t}`,i=e.bundle._terms.get(r);if(!i)return e.reportError(new ReferenceError(`Unknown term: ${r}`)),new FluentNone(r);const[,l]=getArguments(e,a),s=e.cloneForTermReference(l);if(n){const t=i.attributes[n];return t?resolvePattern(s,t):(e.reportError(new ReferenceError(`Unknown attribute: ${n}`)),new FluentNone(`${r}.${n}`))}return resolvePattern(s,i.value)}function FunctionReference(e,{name:t,args:n}){const a=e.bundle._functions[t]||builtins[t];if(!a)return e.reportError(new ReferenceError(`Unknown function: ${t}()`)),new FluentNone(`${t}()`);if("function"!=typeof a)return e.reportError(new TypeError(`Function ${t}() is not callable`)),new FluentNone(`${t}()`);try{return a(...getArguments(e,n))}catch(n){return e.reportError(n),new FluentNone(`${t}()`)}}function SelectExpression(e,{selector:t,variants:n,star:a}){let r=resolveExpression(e,t);if(r instanceof FluentNone)return getDefault(e,n,a);for(const i of n){const t=resolveExpression(e,i.key);if(match(e,r,t))return resolvePattern(e,i.value)}return getDefault(e,n,a)}function resolveComplexPattern(e,t){if(e.dirty.has(t))return e.reportError(new RangeError("Cyclic reference")),new FluentNone;e.dirty.add(t);const n=[],a=e.bundle._useIsolating&&1<t.length;for(const r of t){if("string"==typeof r){n.push(e.bundle._transform(r));continue}const i=resolveExpression(e,r).toString(e);if(a&&n.push(FSI),i.length>MAX_PLACEABLE_LENGTH)throw e.dirty.delete(t),new RangeError("Too many characters in placeable "+`(${i.length}, max allowed is ${MAX_PLACEABLE_LENGTH})`);n.push(i),a&&n.push(PDI)}return e.dirty.delete(t),n.join("")}function resolvePattern(e,t){return"string"==typeof t?e.bundle._transform(t):resolveComplexPattern(e,t)}class Scope{constructor(e,t,n,a=!1,r=new WeakSet){this.bundle=e,this.errors=t,this.args=n,this.insideTermReference=a,this.dirty=r}cloneForTermReference(e){return new Scope(this.bundle,this.errors,e,!0,this.dirty)}reportError(e){if(!this.errors)throw e;this.errors.push(e)}memoizeIntlObject(e,t){let n=this.bundle._intls.get(e);n||(n={},this.bundle._intls.set(e,n));let a=JSON.stringify(t);return n[a]||(n[a]=new e(this.bundle.locales,t)),n[a]}}class FluentBundle{constructor(e,{functions:t={},useIsolating:n=!0,transform:a=e=>e}={}){this.locales=Array.isArray(e)?e:[e],this._terms=new Map,this._messages=new Map,this._functions=t,this._useIsolating=n,this._transform=a,this._intls=new WeakMap}hasMessage(e){return this._messages.has(e)}getMessage(e){return this._messages.get(e)}addResource(e,{allowOverrides:t=!1}={}){const n=[];for(let a,r=0;r<e.body.length;r++)if(a=e.body[r],a.id.startsWith("-")){if(!1===t&&this._terms.has(a.id)){n.push(`Attempt to override an existing term: "${a.id}"`);continue}this._terms.set(a.id,a)}else{if(!1===t&&this._messages.has(a.id)){n.push(`Attempt to override an existing message: "${a.id}"`);continue}this._messages.set(a.id,a)}return n}formatPattern(e,t,n){if("string"==typeof e)return this._transform(e);let a=new Scope(this,n,t);try{let t=resolveComplexPattern(a,e);return t.toString(a)}catch(e){if(a.errors)return a.errors.push(e),new FluentNone().toString(a);throw e}}}class FluentError extends Error{}const RE_MESSAGE_START=/^(-?[a-zA-Z][\w-]*) *= */mg,RE_ATTRIBUTE_START=/\.([a-zA-Z][\w-]*) *= */y,RE_VARIANT_START=/\*?\[/y,RE_NUMBER_LITERAL=/(-?[0-9]+(?:\.([0-9]+))?)/y,RE_IDENTIFIER=/([a-zA-Z][\w-]*)/y,RE_REFERENCE=/([$-])?([a-zA-Z][\w-]*)(?:\.([a-zA-Z][\w-]*))?/y,RE_FUNCTION_NAME=/^[A-Z][A-Z0-9_-]*$/,RE_TEXT_RUN=/([^{}\n\r]+)/y,RE_STRING_RUN=/([^\\"\n\r]*)/y,RE_STRING_ESCAPE=/\\([\\"])/y,RE_UNICODE_ESCAPE=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{6})/y,RE_LEADING_NEWLINES=/^\n+/,RE_TRAILING_SPACES=/ +$/,RE_BLANK_LINES=/ *\r?\n/g,RE_INDENT=/( *)$/,TOKEN_BRACE_OPEN=/{\s*/y,TOKEN_BRACE_CLOSE=/\s*}/y,TOKEN_BRACKET_OPEN=/\[\s*/y,TOKEN_BRACKET_CLOSE=/\s*] */y,TOKEN_PAREN_OPEN=/\s*\(\s*/y,TOKEN_ARROW=/\s*->\s*/y,TOKEN_COLON=/\s*:\s*/y,TOKEN_COMMA=/\s*,?\s*/y,TOKEN_BLANK=/\s+/y,MAX_PLACEABLES=100;class FluentResource{constructor(e){this.body=this._parse(e)}_parse(e){function t(t){return t.lastIndex=I,t.test(e)}function n(t,n){if(e[I]===t)return I++,!0;if(n)throw new n(`Expected ${t}`);return!1}function a(e,n){if(t(e))return I=e.lastIndex,!0;if(n)throw new n(`Expected ${e.toString()}`);return!1}function r(t){t.lastIndex=I;let n=t.exec(e);if(null===n)throw new FluentError(`Expected ${t.toString()}`);return I=t.lastIndex,n}function i(e){return r(e)[1]}function l(e){let t=d(),n=s();if(null===t&&0===Object.keys(n).length)throw new FluentError("Expected message value or attributes");return{id:e,value:t,attributes:n}}function s(){let e=Object.create(null);for(;t(RE_ATTRIBUTE_START);){let t=i(RE_ATTRIBUTE_START),n=d();if(null===n)throw new FluentError("Expected attribute value");e[t]=n}return e}function d(){if(t(RE_TEXT_RUN))var n=i(RE_TEXT_RUN);if("{"===e[I]||"}"===e[I])return o(n?[n]:[],1/0);let a=w();return a?n?o([n,a],a.length):(a.value=E(a.value,RE_LEADING_NEWLINES),o([a],a.length)):n?E(n,RE_TRAILING_SPACES):null}function o(n=[],a){for(let r=0;;){if(t(RE_TEXT_RUN)){n.push(i(RE_TEXT_RUN));continue}if("{"===e[I]){if(++r>MAX_PLACEABLES)throw new FluentError("Too many placeables");n.push(u());continue}if("}"===e[I])throw new FluentError("Unbalanced closing brace");let l=w();if(l){n.push(l),a=Math.min(a,l.length);continue}break}let r=n.length-1;"string"==typeof n[r]&&(n[r]=E(n[r],RE_TRAILING_SPACES));let l=[];for(let e of n)"indent"===e.type&&(e=e.value.slice(0,e.value.length-a)),e&&l.push(e);return l}function u(){a(TOKEN_BRACE_OPEN,FluentError);let e=m();if(a(TOKEN_BRACE_CLOSE))return e;if(a(TOKEN_ARROW)){let t=p();return a(TOKEN_BRACE_CLOSE,FluentError),{type:"select",selector:e,...t}}throw new FluentError("Unclosed placeable")}function m(){if("{"===e[I])return u();if(t(RE_REFERENCE)){let[,e,t,n=null]=r(RE_REFERENCE);if("$"===e)return{type:"var",name:t};if(a(TOKEN_PAREN_OPEN)){let a=g();if("-"===e)return{type:"term",name:t,attr:n,args:a};if(RE_FUNCTION_NAME.test(t))return{type:"func",name:t,args:a};throw new FluentError("Function names must be all upper-case")}return"-"===e?{type:"term",name:t,attr:n,args:[]}:{type:"mesg",name:t,attr:n}}return b()}function g(){for(let t=[];;){switch(e[I]){case")":return I++,t;case void 0:throw new FluentError("Unclosed argument list");}t.push(c()),a(TOKEN_COMMA)}}function c(){let e=m();return"mesg"===e.type?a(TOKEN_COLON)?{type:"narg",name:e.name,value:b()}:e:e}function p(){let e,a=[],r=0;for(;t(RE_VARIANT_START);){n("*")&&(e=r);let t=f(),i=d();if(null===i)throw new FluentError("Expected variant value");a[r++]={key:t,value:i}}if(0===r)return null;if(void 0===e)throw new FluentError("Expected default variant");return{variants:a,star:e}}function f(){a(TOKEN_BRACKET_OPEN,FluentError);let e=t(RE_NUMBER_LITERAL)?h():{type:"str",value:i(RE_IDENTIFIER)};return a(TOKEN_BRACKET_CLOSE,FluentError),e}function b(){if(t(RE_NUMBER_LITERAL))return h();if("\""===e[I])return v();throw new FluentError("Invalid expression")}function h(){let[,e,t=""]=r(RE_NUMBER_LITERAL),n=t.length;return{type:"num",value:parseFloat(e),precision:n}}function v(){n("\"",FluentError);for(let t="";;){if(t+=i(RE_STRING_RUN),"\\"===e[I]){t+=y();continue}if(n("\""))return{type:"str",value:t};throw new FluentError("Unclosed string literal")}}function y(){var e=String.fromCodePoint;if(t(RE_STRING_ESCAPE))return i(RE_STRING_ESCAPE);if(t(RE_UNICODE_ESCAPE)){let[,t,n]=r(RE_UNICODE_ESCAPE),a=parseInt(t||n,16);return 55295>=a||57344<=a?e(a):"\uFFFD"}throw new FluentError("Unknown escape sequence")}function w(){let t=I;switch(a(TOKEN_BLANK),e[I]){case".":case"[":case"*":case"}":case void 0:return!1;case"{":return x(e.slice(t,I));}return" "===e[I-1]&&x(e.slice(t,I))}function E(e,t){return e.replace(t,"")}function x(e){let t=e.replace(RE_BLANK_LINES,"\n"),n=RE_INDENT.exec(e)[1].length;return{type:"indent",value:t,length:n}}RE_MESSAGE_START.lastIndex=0;let k=[],I=0;for(;;){let t=RE_MESSAGE_START.exec(e);if(null===t)break;I=RE_MESSAGE_START.lastIndex;try{k.push(l(t[1]))}catch(e){if(e instanceof FluentError)continue;throw e}}return k}}const reOverlay=/<|&#?\w+;/,TEXT_LEVEL_ELEMENTS={"http://www.w3.org/1999/xhtml":["em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","bdi","bdo","span","br","wbr"]},LOCALIZABLE_ATTRIBUTES={"http://www.w3.org/1999/xhtml":{global:["title","aria-label","aria-valuetext"],a:["download"],area:["download","alt"],input:["alt","placeholder"],menuitem:["label"],menu:["label"],optgroup:["label"],option:["label"],track:["label"],img:["alt"],textarea:["placeholder"],th:["abbr"]},"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul":{global:["accesskey","aria-label","aria-valuetext","label","title","tooltiptext"],description:["value"],key:["key","keycode"],label:["value"],textbox:["placeholder","value"]}};function translateElement(e,t){const{value:n}=t;if("string"==typeof n)if(!reOverlay.test(n))e.textContent=n;else{const t=e.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","template");t.innerHTML=n,overlayChildNodes(t.content,e)}overlayAttributes(t,e)}function overlayChildNodes(e,t){for(const n of e.childNodes)if(n.nodeType!==n.TEXT_NODE){if(n.hasAttribute("data-l10n-name")){const a=getNodeForNamedElement(t,n);e.replaceChild(a,n);continue}if(isElementAllowed(n)){const t=createSanitizedElement(n);e.replaceChild(t,n);continue}console.warn(`An element of forbidden type "${n.localName}" was found in `+"the translation. Only safe text-level elements and elements with data-l10n-name are allowed."),e.replaceChild(createTextNodeFromTextContent(n),n)}t.textContent="",t.appendChild(e)}function hasAttribute(e,t){if(!e)return!1;for(let n of e)if(n.name===t)return!0;return!1}function overlayAttributes(e,t){const n=t.hasAttribute("data-l10n-attrs")?t.getAttribute("data-l10n-attrs").split(",").map(e=>e.trim()):null;for(const a of Array.from(t.attributes))isAttrNameLocalizable(a.name,t,n)&&!hasAttribute(e.attributes,a.name)&&t.removeAttribute(a.name);if(e.attributes)for(const a of Array.from(e.attributes))isAttrNameLocalizable(a.name,t,n)&&t.getAttribute(a.name)!==a.value&&t.setAttribute(a.name,a.value)}function getNodeForNamedElement(e,t){const n=t.getAttribute("data-l10n-name"),a=e.querySelector(`[data-l10n-name="${n}"]`);if(!a)return console.warn(`An element named "${n}" wasn't found in the source.`),createTextNodeFromTextContent(t);if(a.localName!==t.localName)return console.warn(`An element named "${n}" was found in the translation `+`but its type ${t.localName} didn't match the `+`element found in the source (${a.localName}).`),createTextNodeFromTextContent(t);e.removeChild(a);const r=a.cloneNode(!1);return shallowPopulateUsing(t,r)}function createSanitizedElement(e){const t=e.ownerDocument.createElement(e.localName);return shallowPopulateUsing(e,t)}function createTextNodeFromTextContent(e){return e.ownerDocument.createTextNode(e.textContent)}function isElementAllowed(e){const t=TEXT_LEVEL_ELEMENTS[e.namespaceURI];return t&&t.includes(e.localName)}function isAttrNameLocalizable(e,t,n=null){if(n&&n.includes(e))return!0;const a=LOCALIZABLE_ATTRIBUTES[t.namespaceURI];if(!a)return!1;const r=e.toLowerCase(),i=t.localName;if(a.global.includes(r))return!0;if(!a[i])return!1;if(a[i].includes(r))return!0;if("http://www.w3.org/1999/xhtml"===t.namespaceURI&&"input"===i&&"value"===r){const e=t.type.toLowerCase();if("submit"===e||"button"===e||"reset"===e)return!0}return!1}function shallowPopulateUsing(e,t){return t.textContent=e.textContent,overlayAttributes(e,t),t}class CachedIterable extends Array{static from(e){return e instanceof this?e:new this(e)}}class CachedAsyncIterable extends CachedIterable{constructor(e){if(super(),Symbol.asyncIterator in Object(e))this.iterator=e[Symbol.asyncIterator]();else if(Symbol.iterator in Object(e))this.iterator=e[Symbol.iterator]();else throw new TypeError("Argument must implement the iteration protocol.")}[Symbol.asyncIterator](){const e=this;let t=0;return{async next(){return e.length<=t&&e.push(e.iterator.next()),e[t++]}}}async touchNext(e=1){for(let t=0;t++<e;){const e=this[this.length-1];if(e&&(await e).done)break;this.push(this.iterator.next())}return this[this.length-1]}}class Localization{constructor(e=[],t){this.resourceIds=e,this.generateBundles=t,this.onChange(!0)}addResourceIds(e,t=!1){return this.resourceIds.push(...e),this.onChange(t),this.resourceIds.length}removeResourceIds(e){return this.resourceIds=this.resourceIds.filter(t=>!e.includes(t)),this.onChange(),this.resourceIds.length}async formatWithFallback(e,t){const n=[];let a=!1;for await(const r of this.bundles){a=!0;const i=keysFromBundle(t,r,e,n);if(0===i.size)break;if("undefined"!=typeof console){const e=r.locales[0],t=Array.from(i).join(", ");console.warn(`[fluent] Missing translations in ${e}: ${t}`)}}return a||"undefined"==typeof console||console.warn(`[fluent] Request for keys failed because no resource bundles got generated.
  keys: ${JSON.stringify(e)}.
  resourceIds: ${JSON.stringify(this.resourceIds)}.`),n}formatMessages(e){return this.formatWithFallback(e,messageFromBundle)}formatValues(e){return this.formatWithFallback(e,valueFromBundle)}async formatValue(e,t){const[n]=await this.formatValues([{id:e,args:t}]);return n}handleEvent(){this.onChange()}onChange(e=!1){this.bundles=CachedAsyncIterable.from(this.generateBundles(this.resourceIds)),e&&this.bundles.touchNext(2)}}function valueFromBundle(e,t,n,a){return n.value?e.formatPattern(n.value,a,t):null}function messageFromBundle(e,t,n,a){const r={value:null,attributes:null};n.value&&(r.value=e.formatPattern(n.value,a,t));let l=Object.keys(n.attributes);if(0<l.length){r.attributes=Array(l.length);for(let[s,i]of l.entries()){let l=e.formatPattern(n.attributes[i],a,t);r.attributes[s]={name:i,value:l}}}return r}function keysFromBundle(e,t,n,a){const r=[],l=new Set;return n.forEach(({id:n,args:s},d)=>{if(void 0===a[d]){let i=t.getMessage(n);if(!i)l.add(n);else if(r.length=0,a[d]=e(t,r,i,s),0<r.length&&"undefined"!=typeof console){const e=t.locales[0],a=r.join(", ");console.warn(`[fluent][resolver] errors in ${e}/${n}: ${a}.`)}}}),l}const L10NID_ATTR_NAME="data-l10n-id",L10NARGS_ATTR_NAME="data-l10n-args",L10N_ELEMENT_QUERY=`[${"data-l10n-id"}]`;class DOMLocalization extends Localization{constructor(e,t){super(e,t),this.roots=new Set,this.pendingrAF=null,this.pendingElements=new Set,this.windowElement=null,this.mutationObserver=null,this.observerConfig={attributes:!0,characterData:!1,childList:!0,subtree:!0,attributeFilter:[L10NID_ATTR_NAME,L10NARGS_ATTR_NAME]}}onChange(e=!1){super.onChange(e),this.roots&&this.translateRoots()}setAttributes(e,t,n){return e.setAttribute(L10NID_ATTR_NAME,t),n?e.setAttribute(L10NARGS_ATTR_NAME,JSON.stringify(n)):e.removeAttribute(L10NARGS_ATTR_NAME),e}getAttributes(e){return{id:e.getAttribute(L10NID_ATTR_NAME),args:JSON.parse(e.getAttribute(L10NARGS_ATTR_NAME)||null)}}connectRoot(e){for(const t of this.roots)if(t===e||t.contains(e)||e.contains(t))throw new Error("Cannot add a root that overlaps with existing root.");if(!this.windowElement)this.windowElement=e.ownerDocument.defaultView,this.mutationObserver=new this.windowElement.MutationObserver(e=>this.translateMutations(e));else if(this.windowElement!==e.ownerDocument.defaultView)throw new Error(`Cannot connect a root:
          DOMLocalization already has a root from a different window.`);this.roots.add(e),this.mutationObserver.observe(e,this.observerConfig)}disconnectRoot(e){return(this.roots.delete(e),this.pauseObserving(),0===this.roots.size)?(this.mutationObserver=null,this.windowElement=null,this.pendingrAF=null,this.pendingElements.clear(),!0):(this.resumeObserving(),!1)}translateRoots(){const e=Array.from(this.roots);return Promise.all(e.map(e=>this.translateFragment(e)))}pauseObserving(){this.mutationObserver&&(this.translateMutations(this.mutationObserver.takeRecords()),this.mutationObserver.disconnect())}resumeObserving(){if(this.mutationObserver)for(const e of this.roots)this.mutationObserver.observe(e,this.observerConfig)}translateMutations(e){for(const t of e)switch(t.type){case"attributes":t.target.hasAttribute("data-l10n-id")&&this.pendingElements.add(t.target);break;case"childList":for(const e of t.addedNodes)if(e.nodeType===e.ELEMENT_NODE)if(e.childElementCount)for(const t of this.getTranslatables(e))this.pendingElements.add(t);else e.hasAttribute(L10NID_ATTR_NAME)&&this.pendingElements.add(e);}0<this.pendingElements.size&&null===this.pendingrAF&&(this.pendingrAF=this.windowElement.requestAnimationFrame(()=>{this.translateElements(Array.from(this.pendingElements)),this.pendingElements.clear(),this.pendingrAF=null}))}translateFragment(e){return this.translateElements(this.getTranslatables(e))}async translateElements(e){if(!e.length)return;const t=e.map(this.getKeysForElement),n=await this.formatMessages(t);return this.applyTranslations(e,n)}applyTranslations(e,t){this.pauseObserving();for(let n=0;n<e.length;n++)void 0!==t[n]&&translateElement(e[n],t[n]);this.resumeObserving()}getTranslatables(e){const t=Array.from(e.querySelectorAll(L10N_ELEMENT_QUERY));return"function"==typeof e.hasAttribute&&e.hasAttribute(L10NID_ATTR_NAME)&&t.push(e),t}getKeysForElement(e){return{id:e.getAttribute(L10NID_ATTR_NAME),args:JSON.parse(e.getAttribute(L10NARGS_ATTR_NAME)||null)}}}function documentReady(){const e=document.readyState;return"interactive"===e||"completed"===e?Promise.resolve():new Promise(e=>document.addEventListener("readystatechange",e,{once:!0}))}function getMeta(e){return{available:e.querySelector("meta[name=\"availableLanguages\"]").getAttribute("content").split(",").map(e=>e.trim()),default:e.querySelector("meta[name=\"defaultLanguage\"]").getAttribute("content")}}function getResourceLinks(e){return Array.prototype.map.call(e.querySelectorAll("link[rel=\"localization\"]"),e=>e.getAttribute("href"))}async function fetchResource(e,t){const n=t.replace("{locale}",e),a=await fetch(n);return new FluentResource((await a.text()))}async function createContext(e,t){const n=new FluentBundle([e]),a=await Promise.all(t.map(t=>fetchResource(e,t)));for(const r of a)n.addResource(r);return n}const meta=getMeta(document.head);async function*generateMessages(e){const t=negotiateLanguages(navigator.languages,meta.available,{defaultLocale:meta.default});for(const n of t)yield createContext(n,e)}const resourceIds=getResourceLinks(document.head);document.l10n=new DOMLocalization(resourceIds,generateMessages),window.addEventListener("languagechange",document.l10n),document.l10n.ready=documentReady().then(()=>(document.l10n.connectRoot(document.documentElement),document.l10n.translateRoots()));
